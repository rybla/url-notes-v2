{"title":"Infinite Pixels","byline":null,"dir":null,"lang":"en-US","content":"<div id=\"readability-page-1\" class=\"page\"><div>\n<p>I was on one of my rounds of social media trawling, just seeing what was floating through the aether, when I came across <a href=\"https://mastodon.art/@otterlove/114971594534242993\">a toot by Andy P</a> that said:</p>\n<blockquote>\n<div><p>Fun #css trick:</p><p>\n\nwidth: calc(infinity * 1px);<br>\nheight: calc(infinity * 1px);</p></div>\n</blockquote>\n<p>…and I immediately thought, <em>This is a perfect outer-limits probe!</em> By which I mean, if I hand a browser values that are effectively infinite by way of <a href=\"https://www.w3.org/TR/css-values-4/#calc-error-constants\"> the<code>infinity</code> keyword</a>, it will necessarily end up clamping to something finite, thus revealing how far it’s able or willing to go for that property.</p>\n<p>The first thing I did was exactly what Andy proposed, with a few extras to zero out box model extras:</p>\n<pre><code>div {\n\twidth: calc(infinity * 1px);&nbsp; \n\theight: calc(infinity * 1px);\n\tmargin: 0;\n\tpadding: 0; }</code></pre>\n<pre><code>&lt;body&gt;\n&nbsp;  &lt;div&gt;I’m huge!&lt;/div&gt;\n&lt;/body&gt;</code></pre>\n<p>Then I loaded the (fully valid HTML 5) test page in Firefox Nightly, Chrome stable, and Safari stable, all on macOS, and things pretty immediately got weird:</p>\n<table>\n<caption>Element Size Results</caption>\n<thead>\n<tr>\n<th>Browser</th>\n<th>Computed value</th>\n<th>Layout value</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Safari</td>\n<td>33,554,428</td>\n<td>33,554,428</td>\n</tr>\n<tr>\n<td>Chrome</td>\n<td>33,554,400</td>\n<td>33,554,400</td>\n</tr>\n<tr>\n<td>Firefox (Nightly)</td>\n<td>19.2 / 17,895,700</td>\n<td>19.2 / 8,947,840 †</td>\n</tr>\n</tbody>\n</table>\n<p><em>† height / width</em></p>\n<p>Chrome and Safari both get <em>very</em> close to 2<sup>25</sup>-1 (33,554,431), with Safari backing off from that by just 3 pixels, and Chrome by 31.&nbsp; I can’t even hazard a guess as to why this sort of value would be limited in that way; if there was a period of time where 24-bit values were in vogue, I must have missed it.&nbsp; I assume this is somehow rooted in the pre-Blink-fork codebase, but who knows. (Seriously, who knows?&nbsp; I want to talk to you.)</p>\n<p>But the faint whiff of oddness there has <em>nothing</em> on what’s happening in Firefox.&nbsp; First off, the computed height is<code>19.2px</code>, which is the height of a line of text at default font size and line height.&nbsp; If I explicitly gave it<code> line-height: 1</code>, the height of the <code>&lt;div&gt;</code> changes to 16px.&nbsp; All this is despite my assigning a height of infinite pixels!&nbsp; Which, to be fair, is not really possible to do, but does it make sense to just drop it on the floor rather than clamp to an upper bound?</p>\n<p>Even if that can somehow be said to make sense, it <em>only</em> happens with height.&nbsp; The computed width value is, as indicated, nearly 17.9 million, which is not the content width and is also nowhere close to any power of two.&nbsp; But the actual layout width, according to the diagram in the Layout tab, is just over 8.9 million pixels; or, put another way, one-half of 17,895,700 <em> minus 10</em>.</p>\n<p>This frankly makes my brain hurt.&nbsp; I would truly love to understand the reasons for any of these oddities.&nbsp; If you know from whence they arise, please, please leave a comment!&nbsp; The more detail, the better.&nbsp; I also accept trackbacks from blog posts if you want to get extra-detailed.</p>\n<p>For the sake of my aching skullmeats, I almost called a halt there, but I decided to see what happened with font sizes.</p>\n<pre><code>div {\n\twidth: calc(infinity * 1px);&nbsp; \n\theight: calc(infinity * 1px);\n\tmargin: 0;\n\tpadding: 0;\n\tfont-size: calc(infinity * 1px); }</code></pre>\n<p>My skullmeats did not thank me for this, because once again, things got…&nbsp;interesting.</p>\n<table>\n<caption>Font Size Results</caption>\n<thead>\n<tr>\n<th>Browser</th>\n<th>Computed value</th>\n<th>Layout value</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Safari</td>\n<td>100,000</td>\n<td>100,000</td>\n</tr>\n<tr>\n<td>Chrome</td>\n<td>10,000</td>\n<td>10,000</td>\n</tr>\n<tr>\n<td>Firefox (Nightly)</td>\n<td>3.40282e38</td>\n<td>2,400 / 17,895,700 †</td>\n</tr>\n</tbody>\n</table>\n<p><em>† line height values of <code>normal</code> /<code>1</code></em></p>\n<p>Safari and Chrome have pretty clearly set hard limits, with Safari’s an order of magnitude larger than Chrome’s.&nbsp; I get it: what are the odds of someone wanting their text to be any larger than, say, a viewport height, let alone ten or 100 times that height?&nbsp; What intrigues me is the nature of the limits, which are so clearly base-ten numbers that someone typed in at some point, rather than being limited by setting a register size or variable length or something that would have coughed up a power of two.</p>\n<p>And speaking of powers of two… ah, Firefox.&nbsp; Your idiosyncrasy continues.&nbsp; The computed value is a 32-bit <a href=\"https://en.wikipedia.org/wiki/Single-precision_floating-point_format\">single-precision floating-point</a> number.&nbsp; It doesn’t get used in any of the actual rendering, but that’s what it is.&nbsp; Instead, the actual font size of the text, as judged by the Box Model diagram on the Layout tab, is…&nbsp;2,400 pixels.</p>\n<p>Except, I can’t say that’s the <em>actual</em> actual font size being used: I suspect the actual value is 2,000 with a line height of 1.2, which is generally what <code> normal</code> line heights are in browsers. “So why didn’t you just set <code> line-height: 1</code> to verify that, genius?” I hear you asking.&nbsp; I did!&nbsp; And that’s when the layout height of the <code>&lt;div&gt;</code> bloomed to just over 8.9 million pixels, like it probably should have in the previous test!&nbsp; And all the same stuff happened when I moved the styles from the<code>&lt;div&gt;</code> to the <code>&lt;body&gt;</code>!</p>\n<p>I’ve started writing at least three different hypotheses for why this happens, and stopped halfway through each because each hypothesis self-evidently fell apart as I was writing it.&nbsp; Maybe if I give my whimpering neurons a rest, I could come up with something.&nbsp; Maybe not.&nbsp; All I know is, I’d be much happier if someone just explained it to me; bonus points if their name is Clarissa.</p>\n<p>Since setting line heights opened the door to madness in font sizing, I thought I’d try setting <code>line-height</code> to infinite pixels and see what came out.&nbsp; This time, things were (relatively speaking) more sane.</p>\n<table>\n<caption>Line Height Results</caption>\n<thead>\n<tr>\n<th>Browser</th>\n<th>Computed value</th>\n<th>Layout value</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Safari</td>\n<td>33,554,428</td>\n<td>33,554,428</td>\n</tr>\n<tr>\n<td>Chrome</td>\n<td>33,554,400</td>\n<td>33,554,400</td>\n</tr>\n<tr>\n<td>Firefox (Nightly)</td>\n<td>17,895,700</td>\n<td>8,947,840</td>\n</tr>\n</tbody>\n</table>\n<p>Essentially, the results were the same as what happened with element widths in the first example: Safari and Chrome were very close to 2<sup>25</sup>-1, and Firefox had its thing of a strange computed value and a rendering size not <em> quite</em> half the computed value.</p>\n<p>I’m sure there’s a fair bit more to investigate about infinite-pixel values, or about infinite values in general, but I’m going to leave this here because my gray matter needs a rest and possibly a pressure washing.&nbsp; Still, if you have ideas for infinitely fun things to jam into browser engines and see what comes out, let me know.&nbsp; I’m already wondering what kind of shenanigans, other than in <code>z-index</code>, I can get up to with <code> calc(-infinity)</code>…</p> \n</div></div>","textContent":"\nI was on one of my rounds of social media trawling, just seeing what was floating through the aether, when I came across a toot by Andy P that said:\n\nFun #css trick:\n\nwidth: calc(infinity * 1px);\nheight: calc(infinity * 1px);\n\n…and I immediately thought, This is a perfect outer-limits probe! By which I mean, if I hand a browser values that are effectively infinite by way of  theinfinity keyword, it will necessarily end up clamping to something finite, thus revealing how far it’s able or willing to go for that property.\nThe first thing I did was exactly what Andy proposed, with a few extras to zero out box model extras:\ndiv {\n\twidth: calc(infinity * 1px);  \n\theight: calc(infinity * 1px);\n\tmargin: 0;\n\tpadding: 0; }\n<body>\n   <div>I’m huge!</div>\n</body>\nThen I loaded the (fully valid HTML 5) test page in Firefox Nightly, Chrome stable, and Safari stable, all on macOS, and things pretty immediately got weird:\n\nElement Size Results\n\n\nBrowser\nComputed value\nLayout value\n\n\n\n\nSafari\n33,554,428\n33,554,428\n\n\nChrome\n33,554,400\n33,554,400\n\n\nFirefox (Nightly)\n19.2 / 17,895,700\n19.2 / 8,947,840 †\n\n\n\n† height / width\nChrome and Safari both get very close to 225-1 (33,554,431), with Safari backing off from that by just 3 pixels, and Chrome by 31.  I can’t even hazard a guess as to why this sort of value would be limited in that way; if there was a period of time where 24-bit values were in vogue, I must have missed it.  I assume this is somehow rooted in the pre-Blink-fork codebase, but who knows. (Seriously, who knows?  I want to talk to you.)\nBut the faint whiff of oddness there has nothing on what’s happening in Firefox.  First off, the computed height is19.2px, which is the height of a line of text at default font size and line height.  If I explicitly gave it line-height: 1, the height of the <div> changes to 16px.  All this is despite my assigning a height of infinite pixels!  Which, to be fair, is not really possible to do, but does it make sense to just drop it on the floor rather than clamp to an upper bound?\nEven if that can somehow be said to make sense, it only happens with height.  The computed width value is, as indicated, nearly 17.9 million, which is not the content width and is also nowhere close to any power of two.  But the actual layout width, according to the diagram in the Layout tab, is just over 8.9 million pixels; or, put another way, one-half of 17,895,700  minus 10.\nThis frankly makes my brain hurt.  I would truly love to understand the reasons for any of these oddities.  If you know from whence they arise, please, please leave a comment!  The more detail, the better.  I also accept trackbacks from blog posts if you want to get extra-detailed.\nFor the sake of my aching skullmeats, I almost called a halt there, but I decided to see what happened with font sizes.\ndiv {\n\twidth: calc(infinity * 1px);  \n\theight: calc(infinity * 1px);\n\tmargin: 0;\n\tpadding: 0;\n\tfont-size: calc(infinity * 1px); }\nMy skullmeats did not thank me for this, because once again, things got… interesting.\n\nFont Size Results\n\n\nBrowser\nComputed value\nLayout value\n\n\n\n\nSafari\n100,000\n100,000\n\n\nChrome\n10,000\n10,000\n\n\nFirefox (Nightly)\n3.40282e38\n2,400 / 17,895,700 †\n\n\n\n† line height values of normal /1\nSafari and Chrome have pretty clearly set hard limits, with Safari’s an order of magnitude larger than Chrome’s.  I get it: what are the odds of someone wanting their text to be any larger than, say, a viewport height, let alone ten or 100 times that height?  What intrigues me is the nature of the limits, which are so clearly base-ten numbers that someone typed in at some point, rather than being limited by setting a register size or variable length or something that would have coughed up a power of two.\nAnd speaking of powers of two… ah, Firefox.  Your idiosyncrasy continues.  The computed value is a 32-bit single-precision floating-point number.  It doesn’t get used in any of the actual rendering, but that’s what it is.  Instead, the actual font size of the text, as judged by the Box Model diagram on the Layout tab, is… 2,400 pixels.\nExcept, I can’t say that’s the actual actual font size being used: I suspect the actual value is 2,000 with a line height of 1.2, which is generally what  normal line heights are in browsers. “So why didn’t you just set  line-height: 1 to verify that, genius?” I hear you asking.  I did!  And that’s when the layout height of the <div> bloomed to just over 8.9 million pixels, like it probably should have in the previous test!  And all the same stuff happened when I moved the styles from the<div> to the <body>!\nI’ve started writing at least three different hypotheses for why this happens, and stopped halfway through each because each hypothesis self-evidently fell apart as I was writing it.  Maybe if I give my whimpering neurons a rest, I could come up with something.  Maybe not.  All I know is, I’d be much happier if someone just explained it to me; bonus points if their name is Clarissa.\nSince setting line heights opened the door to madness in font sizing, I thought I’d try setting line-height to infinite pixels and see what came out.  This time, things were (relatively speaking) more sane.\n\nLine Height Results\n\n\nBrowser\nComputed value\nLayout value\n\n\n\n\nSafari\n33,554,428\n33,554,428\n\n\nChrome\n33,554,400\n33,554,400\n\n\nFirefox (Nightly)\n17,895,700\n8,947,840\n\n\n\nEssentially, the results were the same as what happened with element widths in the first example: Safari and Chrome were very close to 225-1, and Firefox had its thing of a strange computed value and a rendering size not  quite half the computed value.\nI’m sure there’s a fair bit more to investigate about infinite-pixel values, or about infinite values in general, but I’m going to leave this here because my gray matter needs a rest and possibly a pressure washing.  Still, if you have ideas for infinitely fun things to jam into browser engines and see what comes out, let me know.  I’m already wondering what kind of shenanigans, other than in z-index, I can get up to with  calc(-infinity)… \n","length":6057,"excerpt":"In which I push browser engines to their finite limits using infinite values.","siteName":null,"publishedTime":null}